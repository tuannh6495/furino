@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="home-page">
    <div class="hp-background-top">
        <div class="new-arrival">
            <span class="new-arriva-small-title new-arrival-item">New Arrival</span>
            <h2 class="new-arriva-medium-title new-arrival-item">Discover Our <br />New Collection</h2>
            <p class="new-arriva-description new-arrival-item">Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                Ut elit tellus, luctus nec ullamcorper mattis.</p>
            <button class="new-arriva-btn new-arrival-item">BUY NOW</button>
        </div>
    </div>
    <div class="hp-browse-range">
        <div class="hp-browse-range-info">
            <h2 class="broswe-range-title">Browse The Range</h2>
            <span class="broswe-range-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</span>
        </div>
        <div class="broswe-range-card">
            <div class="broswe-range-card-item">
                <img style="border-radius: 10px;" src="~/img/dining.png" alt="dining"
                    class="broswe-range-card-item-img" />
                <span class="broswe-range-card-item-title">Dining</span>
            </div>
            <div class="broswe-range-card-item">
                <img style="border-radius: 10px;" src="~/img/living.png" alt="living"
                    class="broswe-range-card-item-img" />
                <span class="broswe-range-card-item-title">Living</span>
            </div>
            <div class="broswe-range-card-item">
                <img style="border-radius: 10px;" src="~/img/bedroom.png" alt="bedroom"
                    class="broswe-range-card-item-img" />
                <span class="broswe-range-card-item-title">Bedroom</span>
            </div>
        </div>
    </div>
    <div class="hp-our-products">
        <h2 class="our-products-title">Our Products</h2>
<div class="our-products-list">
    @foreach (var product in Model.Products)
    {
        <partial name="_ProductCard" model="product" />
    }
</div>
<button id="load-more" data-skip="8">Xem thêm</button>


@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#load-more").click(function () {
                var skip = $(this).data("skip");

                $.get("/Index?handler=LoadMore&skip=" + skip, function (data) {
                    if (!data || data.length === 0) {
                        $("#load-more").hide();
                        return;
                    }

                    let newContent = "";

                    data.forEach(function (product) {
                        var discountBadge = "";
                        if (product.percentDiscount > 0) {
                            discountBadge = `<span class="product-badge discount-badge">-${Math.round(product.percentDiscount, 2)}%</span>`;
                        } else if (product.isNew) {
                            discountBadge = `<span class="product-badge new-badge">New</span>`;
                        }

                        var oldPriceHtml = product.price != product.oldPrice
                            ? `<p class="product-price-old">Rp ${product.oldPrice}</p>`
                            : "";

                        newContent += `
                            <div class="product-card">
                                <a href="/Products/Details?id=${product.id}">
                                    ${discountBadge}
                                    <img src="${product.imageUrl}" alt="${product.name}" class="product-image" />
                                </a>
                                <div class="product-info">
                                    <h3 class="product-name">${product.name}</h3>
                                    <p class="product-description">${product.description}</p>
                                    <div class="product-prices">
                                        <p class="product-price">Rp ${product.price}</p>
                                        ${oldPriceHtml}
                                    </div>
                                </div>
                            </div>`;
                    });

                    // Append toàn bộ sản phẩm mới vào danh sách
                    $(".our-products-list").append(newContent);

                    // Cập nhật skip để load tiếp sản phẩm
                    $("#load-more").data("skip", skip + data.length);

                }).fail(function () {
                    alert("Lỗi khi tải dữ liệu. Vui lòng thử lại!");
                });
            });
        });
    </script>
}
    </div>
    <div class="hp-beautiful-ro"></div>
    <div class="hp-furniture"></div>
</div>
